<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Hanger Line Apparel ‚Äî Production Dashboard</title>
  <meta name="description" content="Hanger Line Apparel production dashboard with elegant filters, summary widgets, line-wise performance, and visual analytics." />
  <meta name="keywords" content="apparel, production dashboard, hanger line, loading, offloading, WIP, efficiency, breakdown, analytics" />
  <meta property="og:title" content="Hanger Line Apparel ‚Äî Production Dashboard" />
  <meta property="og:description" content="Elegant production dashboard with filters, summary widgets, line-wise performance cards, and analytics charts." />
  <meta name="twitter:title" content="Hanger Line Apparel ‚Äî Production Dashboard" />
  <meta name="twitter:description" content="Elegant production dashboard with filters, summary widgets, line-wise performance cards, and analytics charts." />

  <script src="https://resource.trickle.so/vendor_lib/unpkg/react@18/umd/react.production.min.js"></script>
  <script src="https://resource.trickle.so/vendor_lib/unpkg/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://resource.trickle.so/vendor_lib/unpkg/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://resource.trickle.so/vendor_lib/unpkg/lucide-static@0.516.0/font/lucide.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.9/dist/chart.umd.min.js"></script>
  <script>
    const ChartJS = window.Chart;
  </script>

  <link href="styles.css" rel="stylesheet">

  <style type="text/tailwindcss">
    @layer theme {
      :root{
        /* Single primary accent (teal) */
        --primary-color:#14b8a6; /* teal-500 */

        /* Dark enterprise base */
        --secondary-color:#07101e; /* deep ink */
        --surface-color:#0a1630; /* navy-slate */
        --muted-surface:#0c1b3a; /* custom */
        --card-color:#081528;

        /* Text */
        --text-color:#e5e7eb; /* gray-200 */
        --muted-text:#9aa8c3; /* blue-slate */

        /* Status */
        --success-color:#22c55e; /* green-500 */
        --danger-color:#ef4444; /* red-500 */
        --warning-color:#f59e0b; /* amber-500 */

        /* Effects */
        --ring-color: rgba(20,184,166,.32);
        --shadow-color: rgba(2,6,23,.40);
        --hover-lift: 10px;
        --hover-brightness: 1.08;
      }
    }

    @layer base {
      html, body { height: 100%; }
      body {
        @apply bg-[#050b18] text-[var(--text-color)] antialiased;
        font-feature-settings: "ss01" on, "cv01" on;
      }
      a { @apply text-[var(--text-color)] no-underline; }
      ::selection { background: rgba(20,184,166,.28); }
    }

    @layer components {
      .app-shell {
        @apply min-h-screen;
        background:
          radial-gradient(1000px 520px at 18% 0%, rgba(20,184,166,.18), transparent 55%),
          radial-gradient(920px 520px at 86% 12%, rgba(99,102,241,.10), transparent 50%),
          radial-gradient(920px 520px at 50% 100%, rgba(245,158,11,.07), transparent 55%),
          linear-gradient(180deg, #040914, #040914);
      }

      .glass {
        @apply bg-white/5 border border-white/10 backdrop-blur-xl;
      }

      .card {
        @apply glass rounded-2xl shadow-[0_18px_60px_var(--shadow-color)] overflow-hidden;
      }

      /* Hover patterns (use on interactive containers) */
      .hover-lift {
        @apply transition;
        transition-duration: 250ms;
        will-change: transform, filter;
      }
      .hover-lift:hover{
        transform: translateY(calc(var(--hover-lift) * -1));
        filter: brightness(var(--hover-brightness));
      }

      .hover-outline {
        @apply transition border border-white/10;
        transition-duration: 250ms;
      }
      .hover-outline:hover{
        border-color: rgba(255,255,255,.18);
        box-shadow: 0 0 0 4px var(--ring-color), 0 18px 60px var(--shadow-color);
      }

      .chip {
        @apply inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs border border-white/10 bg-white/5;
      }

      .btn {
        @apply inline-flex items-center justify-center gap-2 rounded-xl px-4 py-2 text-sm font-semibold transition;
      }

      .btn-primary {
        @apply btn bg-[var(--primary-color)] text-white hover:brightness-110 active:brightness-95;
        box-shadow: 0 10px 35px rgba(20,184,166,.32);
      }

      .btn-ghost {
        @apply btn bg-white/5 text-white border border-white/10 hover:bg-white/10 active:bg-white/5;
      }
      .btn-ghost:hover{
        box-shadow: 0 0 0 4px var(--ring-color);
      }

      .input {
        @apply w-full rounded-xl px-3 py-2 bg-white/5 border border-white/10 text-white placeholder:text-white/30 outline-none;
      }
      .input:focus{
        box-shadow: 0 0 0 4px var(--ring-color);
        border-color: rgba(20,184,166,.55);
      }

      .select {
        @apply input appearance-none pr-10;
      }

      .tile {
        @apply card;
        background:
          radial-gradient(500px 220px at 10% 0%, rgba(14,165,233,.18), transparent 55%),
          linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      }

      .subtle-divider {
        @apply border-t border-white/10;
      }

      .badge-positive {
        @apply inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs;
        background: rgba(34,197,94,.12);
        color: rgb(134 239 172);
        border: 1px solid rgba(34,197,94,.25);
      }

      .badge-negative {
        @apply inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs;
        background: rgba(239,68,68,.12);
        color: rgb(254 202 202);
        border: 1px solid rgba(239,68,68,.25);
      }

      .progress-rail {
        @apply w-full h-2 rounded-full bg-white/10 overflow-hidden;
      }
      .progress-bar {
        @apply h-full rounded-full;
        background: linear-gradient(90deg, rgba(14,165,233,1), rgba(34,197,94,1));
      }
    }

    @layer utilities {
      .text-muted { @apply text-[var(--muted-text)]; }
      .shadow-soft { box-shadow: 0 18px 60px var(--shadow-color); }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <!-- Load only essential utility scripts -->
  <script type="text/babel" src="{% static 'js/utils/format.js' %}?v={% now 'U' %}"></script>
  <script type="text/babel" src="{% static 'js/utils/mockProductionData.js' %}?v={% now 'U' %}"></script>

  <!-- Complete inline dashboard with working components -->
  <script type="text/babel">
    console.log('Loading complete inline dashboard...');

    // Inline component definitions
    class SummaryCard extends React.Component {
      render() {
        const { title, value, iconClass, tone, footnote } = this.props;
        const toneClass = tone === 'positive' ? 'text-green-400' :
                         tone === 'negative' ? 'text-red-400' : 'text-blue-400';

        return (
          <div className="card p-4 hover-lift">
            <div className="flex items-start justify-between gap-3">
              <div>
                <div className="card-title text-sm">{title}</div>
                <div className={`card-value text-xl font-semibold ${toneClass}`}>{value}</div>
                {footnote && <div className="text-xs text-[var(--muted-text)] mt-1">{footnote}</div>}
              </div>
              <div className="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center">
                <div className={`${iconClass} text-lg text-[var(--primary-color)]`}></div>
              </div>
            </div>
          </div>
        );
      }
    }

    class HeaderBar extends React.Component {
      render() {
        const { title, subtitle } = this.props;
        return (
          <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h1 className="text-2xl font-bold text-white mb-1 flex items-center gap-4">
                <img src="/static/images/logo.jpg" alt="Lucrum Logo" style={{height: '50px', verticalAlign: 'middle', borderRadius: '6px'}} />
                {title}
              </h1>
              <p className="text-[var(--muted-text)]">{subtitle}</p>
            </div>
            <div className="flex items-center gap-2">
              <span className="chip">
                <div className="icon-calendar text-xl text-white/90"></div>
                <span className="text-white/90">Live Data</span>
              </span>
            </div>
          </div>
        );
      }
    }

    class FilterBar extends React.Component {
      handleDateChange = (field, value) => {
        const { filters, setFilters } = this.props;
        setFilters({ ...filters, [field]: value });
      }

      handleSelectChange = (field, value) => {
        const { filters, setFilters } = this.props;
        setFilters({ ...filters, [field]: value });
      }

      render() {
        const { filters, onApply } = this.props;
        return (
          <div className="card p-6">
            <div className="flex flex-col md:flex-row md:items-end gap-4">
              <div className="flex-1">
                <label className="block text-sm font-medium text-white mb-2">Date Range</label>
                <div className="flex gap-2">
                  <input
                    type="date"
                    value={filters.startDate}
                    onChange={(e) => this.handleDateChange('startDate', e.target.value)}
                    className="input flex-1"
                  />
                  <input
                    type="date"
                    value={filters.endDate}
                    onChange={(e) => this.handleDateChange('endDate', e.target.value)}
                    className="input flex-1"
                  />
                </div>
              </div>

              <div className="flex-1">
                <label className="block text-sm font-medium text-white mb-2">Filters</label>
                <div className="flex gap-2">
                  <select
                    value={filters.line}
                    onChange={(e) => this.handleSelectChange('line', e.target.value)}
                    className="select flex-1"
                  >
                    <option value="All">All Lines</option>
                    <option value="Line-21">Line-21</option>
                    <option value="Line-22">Line-22</option>
                  </select>
                  <select
                    value={filters.shift}
                    onChange={(e) => this.handleSelectChange('shift', e.target.value)}
                    className="select flex-1"
                  >
                    <option value="All">All Shifts</option>
                    <option value="Day">Day</option>
                    <option value="Night">Night</option>
                  </select>
                </div>
              </div>

              <button onClick={onApply} className="btn-primary px-6 py-2">
                Apply Filters
              </button>
            </div>
          </div>
        );
      }
    }

    class AlertCenter extends React.Component {
      render() {
        const { items, onDismiss } = this.props;
        if (!items || items.length === 0) return null;

        return (
          <div className="fixed bottom-4 right-4 z-50 space-y-2">
            {items.map((item) => (
              <div key={item.id} className={`p-4 rounded-lg shadow-lg max-w-sm ${
                item.type === 'success' ? 'bg-green-500' :
                item.type === 'error' ? 'bg-red-500' : 'bg-blue-500'
              } text-white`}>
                <div className="flex items-start justify-between">
                  <div>
                    <div className="font-semibold">{item.title}</div>
                    <div className="text-sm opacity-90">{item.message}</div>
                  </div>
                  <button
                    onClick={() => onDismiss(item.id)}
                    className="ml-4 text-white/70 hover:text-white"
                  >
                    √ó
                  </button>
                </div>
              </div>
            ))}
          </div>
        );
      }
    }

    class ProductionDashboard extends React.Component {
      constructor(props) {
        super(props);
        console.log('ProductionDashboard constructor called');

        // Safely load injected data
        let dataBundle = null;
        let error = null;

        try {
          console.log('Checking for global data object...');
          console.log('window.data exists:', typeof window.data);

          if (typeof window.data !== 'undefined' && window.data && typeof window.data === 'object') {
            dataBundle = window.data;
            console.log('Successfully loaded injected data:', dataBundle);
          } else {
            console.warn('No injected data found, using fallback');
            dataBundle = this.getFallbackData();
          }
        } catch (dataError) {
          console.error('Error loading data:', dataError);
          error = `Data loading error: ${dataError.message}`;
          dataBundle = this.getFallbackData();
        }

        this.state = {
          filters: {
            startDate: new Date().toISOString().slice(0, 10),
            endDate: new Date().toISOString().slice(0, 10),
            line: 'All',
            shift: 'All',
          },
          toastItems: [],
          dataBundle: dataBundle,
          loading: false,
          error: error,
        };
      }

      getFallbackData = () => {
        console.log('Using fallback data');
        return {
          summary: {
            totalLoading: 26926,
            totalOffloading: 26385,
            totalWip: 541,
            defects: 48,
            totalTarget: 17884,
            variance: 8501,
            variancePct: 47.5,
            achievementPct: 147.5,
            breakdownTimeMin: 120,
            efficiency: 98.0,
            activeLines: 12,
            attendancePct: 94.1,
          },
          summaryCards: [
            { key: 'loading', title: 'Total Loading', value: '26,926', iconClass: 'icon-boxes', tone: 'neutral', footnote: 'Pieces loaded' },
            { key: 'offloading', title: 'Total Offloading', value: '26,385', iconClass: 'icon-package-check', tone: 'neutral', footnote: 'Pieces offloaded' },
            { key: 'wip', title: 'Total WIP', value: '541', iconClass: 'icon-box', tone: 'warning', footnote: 'Work in progress' },
            { key: 'target', title: 'Total Target', value: '17,884', iconClass: 'icon-target', tone: 'neutral', footnote: 'Planned output' },
            { key: 'variance', title: 'Variance', value: '+8,501 / +47.5%', iconClass: 'icon-trending-up', tone: 'positive', footnote: 'Actual vs target' },
            { key: 'achievement', title: 'Achievement %', value: '147.5%', iconClass: 'icon-award', tone: 'positive', footnote: 'Attainment' },
            { key: 'efficiency', title: 'Efficiency', value: '98.0%', iconClass: 'icon-gauge', tone: 'positive', footnote: 'Average line efficiency' },
            { key: 'attendance', title: 'Attendance %', value: '94.1%', iconClass: 'icon-users', tone: 'positive', footnote: 'Present vs active' },
            { key: 'breakdown', title: 'Breakdown Time', value: '120 min', iconClass: 'icon-clock-alert', tone: 'neutral', footnote: 'Downtime minutes' },
            { key: 'defects', title: 'Total Defects', value: '48', iconClass: 'icon-bug', tone: 'neutral', footnote: 'Quality issues' },
            { key: 'lines', title: 'Active Lines', value: '12', iconClass: 'icon-factory', tone: 'neutral', footnote: 'Running lines' },
            { key: 'workforce', title: 'Total Workforce', value: '1,220', iconClass: 'icon-users', tone: 'neutral', footnote: 'Active employees' },
          ],
          lineComparisonRows: []
        };
      }

      componentDidMount() {
        console.log('ProductionDashboard mounted successfully with data:', this.state.dataBundle);
      }

      fetchFilteredData = async (filters) => {
        try {
          console.log('üîÑ Starting fetchFilteredData with filters:', filters);

          // Build query string from filters
          const params = new URLSearchParams();
          if (filters.startDate) params.append('start_date', filters.startDate);
          if (filters.endDate) params.append('end_date', filters.endDate);
          if (filters.line && filters.line !== 'All') params.append('line', filters.line);
          if (filters.shift && filters.shift !== 'All') params.append('shift', filters.shift);

          const queryString = params.toString();
          const apiUrl = `/dashboard/?${queryString}`;

          console.log('üåê Fetching from API URL:', apiUrl);

          // Make AJAX request to API endpoint
          console.log('üì° Making AJAX request...');
          const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
              'X-Requested-With': 'XMLHttpRequest',
              'Accept': 'application/json',
              'Content-Type': 'application/json',
            },
          });

          console.log('üìä Response status:', response.status);
          console.log('üìä Response ok:', response.ok);

          if (!response.ok) {
            const errorText = await response.text();
            console.error('‚ùå HTTP Error response:', errorText);
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const jsonData = await response.json();
          console.log('üìÑ Received JSON response:', jsonData);

          // Check if response contains error
          if (jsonData.error) {
            throw new Error(jsonData.error);
          }

          console.log('‚úÖ Successfully received filtered data');
          this.setState({ dataBundle: jsonData, loading: false });
          return jsonData;

        } catch (error) {
          console.error('üí• Error in fetchFilteredData:', error);
          console.error('üí• Error stack:', error.stack);
          this.addToast({
            type: 'error',
            title: 'Filter Error',
            message: `Failed to apply filters: ${error.message}`
          });
          throw error;
        }
      }

      addToast = (item) => {
        const newToast = { ...item, id: `${Date.now()}-${Math.random()}` };
        this.setState(prevState => ({
          toastItems: [...prevState.toastItems, newToast].slice(-4)
        }));

        // Auto-dismiss after 4 seconds
        setTimeout(() => {
          this.setState(prevState => ({
            toastItems: prevState.toastItems.filter(t => t.id !== newToast.id)
          }));
        }, 4000);
      }

      onApplyFilters = async () => {
        try {
          console.log('üéØ Applying filters:', this.state.filters);
          this.setState({ loading: true });

          // Fetch new data with applied filters
          const newData = await this.fetchFilteredData(this.state.filters);
          console.log('üìä Filter response received:', newData);

          if (newData && newData.summary) {
            console.log('‚úÖ Filter successful - new summary:', newData.summary);
          } else {
            console.warn('‚ö†Ô∏è Filter response missing expected data structure');
          }

          this.addToast({
            type: 'success',
            title: 'Filters Applied',
            message: 'Dashboard updated with new filter settings.'
          });
        } catch (error) {
          console.error('üí• Filter application error:', error);
          this.addToast({
            type: 'error',
            title: 'Filter Error',
            message: `Failed to apply filters: ${error.message}`
          });
        } finally {
          this.setState({ loading: false });
        }
      }

      render() {
        const { loading, dataBundle, filters, toastItems } = this.state;

        if (loading) {
          return (
            <div className="app-shell flex items-center justify-center min-h-screen">
              <div className="card p-8">
                <div className="text-white text-xl mb-4">Loading Production Dashboard...</div>
                <div className="w-64 h-2 bg-white/20 rounded-full overflow-hidden">
                  <div className="h-full bg-[var(--primary-color)] rounded-full animate-pulse" style={{width: '60%'}}></div>
                </div>
              </div>
            </div>
          );
        }

        const summary = dataBundle?.summary || {};
        const summaryCards = dataBundle?.summaryCards || [];

        return (
          <div className="app-shell">
            <div className="max-w-7xl mx-auto px-4 py-6">
              {/* Header */}
              <HeaderBar
                title="Hanger Line Apparel"
                subtitle="Production Dashboard"
              />

              {/* Filters */}
              <div className="mt-5">
                <FilterBar
                  filters={filters}
                  setFilters={(newFilters) => this.setState({ filters: { ...filters, ...newFilters } })}
                  onApply={this.onApplyFilters}
                />
              </div>

              {/* Production Snapshot */}
              <div className="mt-6">
                <div className="tile p-6 hover-lift hover-outline">
                  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                      <div className="flex items-center gap-3">
                        <div className="w-12 h-12 rounded-2xl bg-[var(--primary-color)] flex items-center justify-center shadow-[0_14px_40px_rgba(14,165,233,.35)]">
                          <div className="icon-chart-bar text-2xl text-white"></div>
                        </div>
                        <div>
                          <div className="text-white text-xl font-semibold">Production Snapshot</div>
                          <div className="text-sm text-[var(--muted-text)]">
                            Real-time overview with key performance indicators and operational metrics.
                          </div>
                        </div>
                      </div>
                    </div>

                    <div className="flex flex-wrap items-center gap-2">
                      <span className="chip">
                        <div className="icon-factory text-xl text-white/90"></div>
                        <span className="text-white/90">{summary.activeLines || 12} Active Lines</span>
                      </span>
                      <span className="chip">
                        <div className="icon-gauge text-xl text-white/90"></div>
                        <span className="text-white/90">{summary.efficiency || 98.0}% Efficiency</span>
                      </span>
                      <span className="chip">
                        <div className="icon-clock text-xl text-white/90"></div>
                        <span className="text-white/90">{summary.breakdownTimeMin || 120} min Breakdown</span>
                      </span>
                    </div>
                  </div>

                  <div className="mt-6 subtle-divider"></div>

                  <div className="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <SummaryCard
                      title="Variance"
                      value={`${summary.variance >= 0 ? '+' : ''}${summary.variance || 8501} / ${summary.variancePct >= 0 ? '+' : ''}${summary.variancePct || 47.5}%`}
                      iconClass="icon-trending-up"
                      tone="positive"
                      footnote="Against total target"
                    />
                    <SummaryCard
                      title="Attendance %"
                      value={`${summary.attendancePct || 94.1}%`}
                      iconClass="icon-users"
                      tone="positive"
                      footnote="Present vs active employees"
                    />
                    <SummaryCard
                      title="Total WIP"
                      value={String(summary.totalWip || 541)}
                      iconClass="icon-box"
                      tone="warning"
                      footnote="Work in progress"
                    />
                  </div>
                </div>
              </div>

              {/* Summary Cards */}
              <div className="mt-8">
                <div className="flex items-center justify-between gap-4 mb-4">
                  <div>
                    <div className="text-white font-semibold text-lg">Total Summary</div>
                    <div className="text-sm text-[var(--muted-text)]">
                      Comprehensive operational metrics and key performance indicators.
                    </div>
                  </div>
                  <div className="text-sm text-[var(--muted-text)]">
                    {summaryCards.length} metrics displayed
                  </div>
                </div>

                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4">
                  {summaryCards.map((card, index) => (
                    <SummaryCard
                      key={card.key || index}
                      title={card.title}
                      value={card.value}
                      iconClass={card.iconClass}
                      tone={card.tone}
                      footnote={card.footnote}
                    />
                  ))}
                </div>
              </div>

              {/* Line-wise Performance */}
              <div className="mt-8">
                <div className="flex items-end justify-between gap-4 mb-4">
                  <div>
                    <div className="text-white font-semibold text-lg">Line-wise Performance</div>
                    <div className="text-sm text-[var(--muted-text)]">
                      Individual line metrics with efficiency, targets, and variance analysis.
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="chip">
                      <div className="icon-target text-xl text-white/90"></div>
                      <span className="text-white/90">Target: {summary.totalTarget ? summary.totalTarget.toLocaleString() : '17,884'}</span>
                    </span>
                    <span className="chip">
                      <div className="icon-package-check text-xl text-white/90"></div>
                      <span className="text-white/90">Total: {summary.totalOffloading ? summary.totalOffloading.toLocaleString() : '26,385'}</span>
                    </span>
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                  {/* Top Loading Lines */}
                  <div className="card p-6">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center">
                        <div className="icon-boxes text-xl text-blue-400"></div>
                      </div>
                      <div>
                        <div className="text-white font-semibold">Top Loading Lines</div>
                        <div className="text-sm text-[var(--muted-text)]">Lines with highest loading volume</div>
                      </div>
                    </div>
                    <div className="space-y-3">
                      {(dataBundle.lineComparisonRows || []).slice(0, 3).map((item, index) => {
                        const totalLoading = summary.totalLoading || 26926;
                        const percent = totalLoading > 0 ? ((item.loading || 0) / totalLoading * 100).toFixed(1) : 0;
                        return (
                          <div key={index} className="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                            <div className="flex items-center gap-3">
                              <div className="w-8 h-8 rounded-lg bg-[var(--primary-color)]/20 flex items-center justify-center">
                                <span className="text-xs font-bold text-[var(--primary-color)]">{(item.line || '').slice(-2)}</span>
                              </div>
                              <div>
                                <div className="text-white font-medium">{item.line || 'Unknown'}</div>
                                <div className="text-xs text-[var(--muted-text)]">Eff: {item.efficiency || 0}%</div>
                              </div>
                            </div>
                            <div className="text-right">
                              <div className="text-white font-semibold">{(item.loading || 0).toLocaleString()}</div>
                              <div className="text-xs text-[var(--muted-text)]">{percent}% of total</div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* Efficiency Leaders */}
                  <div className="card p-6">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center">
                        <div className="icon-gauge text-xl text-green-400"></div>
                      </div>
                      <div>
                        <div className="text-white font-semibold">Efficiency Leaders</div>
                        <div className="text-sm text-[var(--muted-text)]">Highest performing lines</div>
                      </div>
                    </div>
                    <div className="space-y-3">
                      {(dataBundle.lineComparisonRows || [])
                        .sort((a, b) => (b.efficiency || 0) - (a.efficiency || 0))
                        .slice(0, 3)
                        .map((item, index) => (
                          <div key={index} className="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                            <div className="flex items-center gap-3">
                              <div className="w-8 h-8 rounded-lg bg-green-500/20 flex items-center justify-center">
                                <span className="text-xs font-bold text-green-400">{(item.line || '').slice(-2)}</span>
                              </div>
                              <div>
                                <div className="text-white font-medium">{item.line || 'Unknown'}</div>
                                <div className="text-xs text-[var(--muted-text)]">{item.efficiency || 0}% efficiency</div>
                              </div>
                            </div>
                            <div className="text-right">
                              <div className={`text-sm font-semibold ${item.variance >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                {item.variance >= 0 ? '+' : ''}{item.variance || 0}
                              </div>
                              <div className="text-xs text-[var(--muted-text)]">{(item.offloading || 0).toLocaleString()}/{(item.target || 0).toLocaleString()}</div>
                            </div>
                          </div>
                        ))}
                    </div>
                  </div>
                </div>
              </div>

              {/* Line Comparison Table */}
              <div className="mt-8">
                <div className="flex items-end justify-between gap-4 mb-4">
                  <div>
                    <div className="text-white font-semibold text-lg">Line Comparison</div>
                    <div className="text-sm text-[var(--muted-text)]">
                      Detailed comparison of all production lines with sortable metrics.
                    </div>
                  </div>
                  <div className="text-sm text-[var(--muted-text)]">
                    {((dataBundle.lineComparisonRows || []).length)} active lines ‚Ä¢ Click headers to sort
                  </div>
                </div>

                <div className="card p-6">
                  <div className="overflow-x-auto">
                    <table className="min-w-full divide-y divide-white/10">
                      <thead>
                        <tr className="bg-white/5">
                          <th className="px-4 py-3 text-left text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">Line</th>
                          <th className="px-4 py-3 text-right text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">Loading</th>
                          <th className="px-4 py-3 text-right text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">Offloading</th>
                          <th className="px-4 py-3 text-right text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">WIP</th>
                          <th className="px-4 py-3 text-right text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">Target</th>
                          <th className="px-4 py-3 text-right text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">Efficiency</th>
                          <th className="px-4 py-3 text-right text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">Variance</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-white/5">
                        {(dataBundle.lineComparisonRows || []).map((row, index) => (
                          <tr key={index} className="hover:bg-white/5 transition-colors">
                            <td className="px-4 py-3 text-sm font-medium text-white">{row.line || 'Unknown'}</td>
                            <td className="px-4 py-3 text-sm text-right text-[var(--muted-text)]">{(row.loading || 0).toLocaleString()}</td>
                            <td className="px-4 py-3 text-sm text-right text-[var(--muted-text)]">{(row.offloading || 0).toLocaleString()}</td>
                            <td className={`px-4 py-3 text-sm text-right ${(row.wip || 0) > 60 ? 'text-orange-400' : 'text-[var(--muted-text)]'}`}>{row.wip || 0}</td>
                            <td className="px-4 py-3 text-sm text-right text-[var(--muted-text)]">{(row.target || 0).toLocaleString()}</td>
                            <td className={`px-4 py-3 text-sm text-right ${(row.efficiency || 0) >= 98 ? 'text-green-400' : (row.efficiency || 0) >= 95 ? 'text-blue-400' : 'text-orange-400'}`}>
                              {row.efficiency || 0}%
                            </td>
                            <td className={`px-4 py-3 text-sm text-right ${(row.variance || 0) > 0 ? 'text-green-400' : 'text-red-400'}`}>
                              {(row.variance || 0) > 0 ? '+' : ''}{(row.variance || 0).toLocaleString()}
                            </td>
                          </tr>
                        ))}
                      </tbody>
                      <tfoot>
                        <tr className="bg-white/10 border-t border-white/20">
                          <td className="px-4 py-3 text-sm font-semibold text-white">Totals</td>
                          <td className="px-4 py-3 text-sm text-right font-semibold text-white">{(summary.totalLoading || 0).toLocaleString()}</td>
                          <td className="px-4 py-3 text-sm text-right font-semibold text-white">{(summary.totalOffloading || 0).toLocaleString()}</td>
                          <td className="px-4 py-3 text-sm text-right font-semibold text-orange-400">{(summary.totalWip || 0).toLocaleString()}</td>
                          <td className="px-4 py-3 text-sm text-right font-semibold text-white">{(summary.totalTarget || 0).toLocaleString()}</td>
                          <td className="px-4 py-3 text-sm text-right font-semibold text-green-400">{summary.efficiency || 0}%</td>
                          <td className={`px-4 py-3 text-sm text-right font-semibold ${(summary.variance || 0) > 0 ? 'text-green-400' : 'text-red-400'}`}>
                            {(summary.variance || 0) > 0 ? '+' : ''}{(summary.variance || 0).toLocaleString()}
                          </td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>
              </div>

              {/* Analytics Section */}
              <div className="mt-8">
                <div className="flex items-center justify-between gap-4 mb-4">
                  <div>
                    <div className="text-white font-semibold text-lg">Analytics & Trends</div>
                    <div className="text-sm text-[var(--muted-text)]">
                      Visual analytics with charts and trend analysis for operational insights.
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="chip">
                      <div className="icon-bar-chart text-xl text-white/90"></div>
                      <span className="text-white/90">Interactive Charts</span>
                    </span>
                    <span className="chip">
                      <div className="icon-trending-up text-xl text-white/90"></div>
                      <span className="text-white/90">Trend Analysis</span>
                    </span>
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                  {/* Production Flow Chart */}
                  <div className="lg:col-span-8">
                    <div className="card p-6">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center">
                          <div className="icon-bar-chart-3 text-xl text-purple-400"></div>
                        </div>
                        <div>
                          <div className="text-white font-semibold">Production Flow Analysis</div>
                          <div className="text-sm text-[var(--muted-text)]">Loading ‚Üí Offloading ‚Üí WIP movement by line</div>
                        </div>
                      </div>
                      <div className="h-64 bg-gradient-to-r from-blue-500/10 via-purple-500/10 to-green-500/10 rounded-lg flex items-center justify-center border border-white/10">
                        <div className="text-center">
                          <div className="icon-bar-chart text-4xl text-[var(--muted-text)] mb-2"></div>
                          <div className="text-[var(--muted-text)]">Interactive Chart Area</div>
                          <div className="text-xs text-[var(--muted-text)] mt-1">Chart.js integration ready</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Trend Cards */}
                  <div className="lg:col-span-4 space-y-4">
                    <div className="card p-4">
                      <div className="flex items-center justify-between">
                        <div>
                          <div className="text-sm text-[var(--muted-text)]">Efficiency Trend</div>
                          <div className="text-lg font-semibold text-green-400">‚ÜóÔ∏è +2.3%</div>
                        </div>
                        <div className="w-8 h-8 rounded-lg bg-green-500/20 flex items-center justify-center">
                          <div className="icon-trending-up text-lg text-green-400"></div>
                        </div>
                      </div>
                      <div className="mt-2 text-xs text-[var(--muted-text)]">vs last week</div>
                    </div>

                    <div className="card p-4">
                      <div className="flex items-center justify-between">
                        <div>
                          <div className="text-sm text-[var(--muted-text)]">WIP Reduction</div>
                          <div className="text-lg font-semibold text-blue-400">‚ÜòÔ∏è -8.1%</div>
                        </div>
                        <div className="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center">
                          <div className="icon-trending-down text-lg text-blue-400"></div>
                        </div>
                      </div>
                      <div className="mt-2 text-xs text-[var(--muted-text)]">inventory optimization</div>
                    </div>

                    <div className="card p-4">
                      <div className="flex items-center justify-between">
                        <div>
                          <div className="text-sm text-[var(--muted-text)]">Breakdown Time</div>
                          <div className="text-lg font-semibold text-orange-400">‚ÜóÔ∏è +15 min</div>
                        </div>
                        <div className="w-8 h-8 rounded-lg bg-orange-500/20 flex items-center justify-center">
                          <div className="icon-clock-alert text-lg text-orange-400"></div>
                        </div>
                      </div>
                      <div className="mt-2 text-xs text-[var(--muted-text)]">needs attention</div>
                    </div>
                  </div>
                </div>

                {/* Line Trend Chart - Last 30 Days */}
                <div className="mb-8">
                  <div className="flex items-center justify-between gap-4 mb-4">
                    <div>
                      <div className="text-white font-semibold text-lg">Production Trend - Last 30 Days</div>
                      <div className="text-sm text-[var(--muted-text)]">
                        Daily production metrics with efficiency and WIP tracking over time.
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      <span className="chip">
                        <div className="icon-trending-up text-xl text-white/90"></div>
                        <span className="text-white/90">30-Day Trend</span>
                      </span>
                    </div>
                  </div>

                  <div className="card p-6">
                    <div className="h-80 flex items-center justify-center">
                      <canvas id="lineTrendChart" width="800" height="300"></canvas>
                    </div>
                  </div>
                </div>

                {/* Pie Charts Row */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {/* Production Distribution Pie */}
                  <div className="card p-6">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="w-8 h-8 rounded-lg bg-green-500/20 flex items-center justify-center">
                        <div className="icon-target text-lg text-green-400"></div>
                      </div>
                      <div className="text-white font-semibold">Production vs Target</div>
                    </div>
                    <div className="h-48 flex items-center justify-center">
                      <canvas id="productionPieChart" width="200" height="200"></canvas>
                    </div>
                  </div>

                  {/* Defect Breakdown Pie */}
                  <div className="card p-6">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="w-8 h-8 rounded-lg bg-red-500/20 flex items-center justify-center">
                        <div className="icon-bug text-lg text-red-400"></div>
                      </div>
                      <div className="text-white font-semibold">Defect Breakdown</div>
                    </div>
                    <div className="h-48 flex items-center justify-center">
                      <canvas id="defectPieChart" width="200" height="200"></canvas>
                    </div>
                  </div>

                  {/* Line Performance Pie */}
                  <div className="card p-6">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center">
                        <div className="icon-factory text-lg text-blue-400"></div>
                      </div>
                      <div className="text-white font-semibold">Line Performance</div>
                    </div>
                    <div className="h-48 flex items-center justify-center">
                      <canvas id="linePieChart" width="200" height="200"></canvas>
                    </div>
                  </div>

                  {/* Shift Distribution Pie */}
                  <div className="card p-6">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center">
                        <div className="icon-clock text-lg text-purple-400"></div>
                      </div>
                      <div className="text-white font-semibold">Shift Distribution</div>
                    </div>
                    <div className="h-48 flex items-center justify-center">
                      <canvas id="shiftPieChart" width="200" height="200"></canvas>
                    </div>
                  </div>
                </div>
              </div>



              {/* Footer */}
              <div className="mt-12 pb-10">
                <div className="card px-6 py-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3 hover-outline">
                  <div className="text-sm text-[var(--muted-text)]">
                    <span className="text-white/90 font-medium">Hanger Line Apparel</span>
                    <span className="mx-2">¬∑</span>
                    <span>Production Dashboard</span>
                    <span className="mx-2">¬∑</span>
                    <span>¬© 2026</span>
                  </div>
                  <div className="flex items-center gap-3">
                    <span className="chip">
                      <div className="icon-shield text-xl text-white/90"></div>
                      <span className="text-white/90">Enterprise Dashboard</span>
                    </span>
                    <span className="chip">
                      <div className="icon-refresh-cw text-xl text-white/90"></div>
                      <span className="text-white/90">Real-time Data</span>
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <AlertCenter items={toastItems} onDismiss={(id) => this.setState(prevState => ({
              toastItems: prevState.toastItems.filter(t => t.id !== id)
            }))} />
          </div>
        );
      }
    }

    console.log('Rendering ProductionDashboard...');
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ProductionDashboard />);
    console.log('ProductionDashboard rendered successfully!');
  </script>

  <script>
    console.log('Full React dashboard loaded');
  </script>

  <script>
    console.log('React app loaded, checking for errors...');
    // Check if React mounted successfully
    setTimeout(() => {
      const root = document.getElementById('root');
      console.log('Root element:', root);
      console.log('Root children:', root ? root.children.length : 'no root');
      if (root && root.children.length === 0) {
        console.error('React did not mount - root element is empty');
        root.innerHTML = '<div style="color: white; padding: 20px; background: #ff6b6b;">React failed to load. Check console for errors.</div>';
      } else {
        console.log('React appears to have mounted successfully');
        // Initialize charts after React mounts
        initializeCharts();
      }
    }, 1000);

    function initializeCharts() {
      console.log('Initializing Chart.js charts...');
      console.log('Chart.js available:', typeof Chart);
      console.log('window.data available:', typeof window.data);

      // Get data from window.data (injected by Django)
      const dataBundle = window.data || {};
      const pieCharts = dataBundle.pieCharts || {};
      const lineTrendData = dataBundle.lineTrendData || [];

      console.log('Data bundle:', dataBundle);
      console.log('Pie charts data:', pieCharts);
      console.log('Line trend data:', lineTrendData);

      // Check if Chart.js is loaded
      if (typeof Chart === 'undefined') {
        console.error('Chart.js not loaded!');
        return;
      }

      // Chart.js configuration for dark theme
      const pieChartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        cutout: '50%', // Donut chart
        plugins: {
          legend: {
            labels: {
              color: '#e5e7eb', // white text
              font: {
                size: 12
              }
            },
            position: 'bottom'
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleColor: '#e5e7eb',
            bodyColor: '#e5e7eb',
            borderColor: 'rgba(20, 184, 166, 0.3)',
            borderWidth: 1
          }
        }
      };

      const lineChartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: '#9aa8c3',
              maxTicksLimit: 10
            }
          },
          y: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: '#9aa8c3'
            }
          }
        },
        plugins: {
          legend: {
            labels: {
              color: '#e5e7eb',
              font: {
                size: 12
              }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleColor: '#e5e7eb',
            bodyColor: '#e5e7eb',
            borderColor: 'rgba(20, 184, 166, 0.3)',
            borderWidth: 1
          }
        }
      };

      // Production vs Target Pie Chart
      const productionCanvas = document.getElementById('productionPieChart');
      console.log('Production canvas found:', !!productionCanvas);
      console.log('Production data:', pieCharts.productionDistribution);

      if (productionCanvas && pieCharts.productionDistribution && pieCharts.productionDistribution.length > 0) {
        const productionData = pieCharts.productionDistribution;
        console.log('Creating production pie chart with data:', productionData);

        try {
          new Chart(productionCanvas, {
            type: 'pie',
            data: {
              labels: productionData.map(d => d.label),
              datasets: [{
                data: productionData.map(d => d.value),
                backgroundColor: productionData.map(d => d.color),
                borderWidth: 2,
                borderColor: 'rgba(255, 255, 255, 0.1)'
              }]
            },
            options: pieChartOptions  // Use donut options
          });
          console.log('Production pie chart created successfully');
        } catch (error) {
          console.error('Error creating production pie chart:', error);
        }
      } else {
        console.warn('Production pie chart not created - missing canvas or data');
      }

      // Defect Breakdown Pie Chart
      const defectCanvas = document.getElementById('defectPieChart');
      if (defectCanvas && pieCharts.defectBreakdown) {
        const defectData = pieCharts.defectBreakdown;
        new Chart(defectCanvas, {
          type: 'pie',
          data: {
            labels: defectData.map(d => d.label),
            datasets: [{
              data: defectData.map(d => d.value),
              backgroundColor: defectData.map(d => d.color),
              borderWidth: 2,
              borderColor: 'rgba(255, 255, 255, 0.1)'
            }]
          },
          options: pieChartOptions  // Donut options
        });
      }

      // Line Performance Pie Chart
      const lineCanvas = document.getElementById('linePieChart');
      if (lineCanvas && pieCharts.linePerformance) {
        const lineData = pieCharts.linePerformance;
        new Chart(lineCanvas, {
          type: 'pie',
          data: {
            labels: lineData.map(d => d.label),
            datasets: [{
              data: lineData.map(d => d.value),
              backgroundColor: lineData.map(d => d.color),
              borderWidth: 2,
              borderColor: 'rgba(255, 255, 255, 0.1)'
            }]
          },
          options: pieChartOptions  // Donut options
        });
      }

      // Shift Distribution Pie Chart
      const shiftCanvas = document.getElementById('shiftPieChart');
      if (shiftCanvas && pieCharts.shiftDistribution) {
        const shiftData = pieCharts.shiftDistribution;
        new Chart(shiftCanvas, {
          type: 'pie',
          data: {
            labels: shiftData.map(d => d.label),
            datasets: [{
              data: shiftData.map(d => d.value),
              backgroundColor: shiftData.map(d => d.color),
              borderWidth: 2,
              borderColor: 'rgba(255, 255, 255, 0.1)'
            }]
          },
          options: pieChartOptions  // Donut options
        });
      }

      // Line Trend Chart (Last 30 Days)
      const trendCanvas = document.getElementById('lineTrendChart');
      console.log('Trend canvas found:', !!trendCanvas);
      console.log('Line trend data length:', lineTrendData.length);

      // Use mock data if no real data available
      let chartData = lineTrendData;
      if (!lineTrendData || lineTrendData.length === 0) {
        console.log('Using mock data for line trend chart');
        // Generate mock data for last 30 days
        chartData = [];
        const today = new Date();
        for (let i = 29; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          const baseValue = 1500 + Math.random() * 500; // Base production around 1500-2000
          chartData.push({
            date: date.toISOString().split('T')[0],
            loading: Math.round(baseValue + Math.random() * 200),
            offloading: Math.round(baseValue * 0.9 + Math.random() * 100),
            efficiency: Math.round(85 + Math.random() * 15), // 85-100% efficiency
            wip: Math.round(baseValue * 0.1 + Math.random() * 50)
          });
        }
      }

      if (trendCanvas && chartData.length > 0) {
        // Prepare data for line chart
        const dates = chartData.map(d => {
          const date = new Date(d.date);
          return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        });
        const loadingData = chartData.map(d => d.loading);
        const offloadingData = chartData.map(d => d.offloading);
        const wipData = chartData.map(d => d.wip);

        console.log('Creating line trend chart with', chartData.length, 'data points');

        try {
          new Chart(trendCanvas, {
            type: 'line',
            data: {
              labels: dates,
              datasets: [
                {
                  label: 'Loading',
                  data: loadingData,
                  borderColor: '#3b82f6',
                  backgroundColor: 'rgba(59, 130, 246, 0.1)',
                  tension: 0.4,
                  fill: false,
                  pointRadius: 3,
                  pointHoverRadius: 6
                },
                {
                  label: 'Offloading',
                  data: offloadingData,
                  borderColor: '#22c55e',
                  backgroundColor: 'rgba(34, 197, 94, 0.1)',
                  tension: 0.4,
                  fill: false,
                  pointRadius: 3,
                  pointHoverRadius: 6
                },
                {
                  label: 'WIP',
                  data: wipData,
                  borderColor: '#f59e0b',
                  backgroundColor: 'rgba(245, 158, 11, 0.1)',
                  tension: 0.4,
                  fill: false,
                  pointRadius: 3,
                  pointHoverRadius: 6
                }
              ]
            },
            options: lineChartOptions
          });
          console.log('Line trend chart created successfully');
        } catch (error) {
          console.error('Error creating line trend chart:', error);
        }
      } else {
        console.warn('Line trend chart not created - missing canvas or data');
      }

      console.log('Chart.js charts initialized successfully');
    }
  </script>
</body>
</html>
